<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelist Test</title>
</head>
<body>
    <h1>Whitelist Functionality Test</h1>
    
    <div>
        <h2>Test Chrome Extension Whitelist</h2>
        <button onclick="testAddWhitelist()">Add test.com to Whitelist</button>
        <button onclick="testGetWhitelist()">Get Whitelisted Domains</button>
        <button onclick="testRemoveWhitelist()">Remove test.com from Whitelist</button>
        <div id="output"></div>
    </div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        function testAddWhitelist() {
            if (chrome && chrome.runtime) {
                chrome.runtime.sendMessage({
                    type: 'addToWhitelist',
                    domain: 'test.com'
                }, (response) => {
                    log('Add to whitelist response: ' + JSON.stringify(response));
                });
            } else {
                log('Chrome extension API not available');
            }
        }
        
        function testGetWhitelist() {
            if (chrome && chrome.runtime) {
                chrome.runtime.sendMessage({
                    type: 'getWhitelistedDomains'
                }, (response) => {
                    log('Whitelisted domains: ' + JSON.stringify(response, null, 2));
                });
            } else {
                log('Chrome extension API not available');
            }
        }
        
        function testRemoveWhitelist() {
            if (chrome && chrome.runtime) {
                // First get the hash of test.com
                const CryptoJS = window.CryptoJS || crypto.subtle;
                if (CryptoJS) {
                    chrome.runtime.sendMessage({
                        type: 'removeFromWhitelist',
                        key: 'vanta_' + CryptoJS.SHA256('test.com').toString(CryptoJS.enc.Hex)
                    }, (response) => {
                        log('Remove from whitelist response: ' + JSON.stringify(response));
                    });
                } else {
                    log('CryptoJS not available');
                }
            } else {
                log('Chrome extension API not available');
            }
        }
    </script>
</body>
</html>
